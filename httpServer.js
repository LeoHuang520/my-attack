var express = require('express');
var app = express();
var server = require('http').Server(app);
var io = require("socket.io")(server);
var ws = 0;
var token = "";

function getTstr() {
    var d = new Date();
    var tStr = d.getTime();
    return tStr;
}
var idp = 1;

function getIdp() {
    idp++;
    return idp + Math.ceil(Math.random() * 1000)

}

var dataStart = { "status": "ok", "msg": "\u603b\u517143\u6761\u6570", "knowledge": [{ "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.106", "knowledge": { "ip": "172.16.1.106", "id": "657d57bf2357d8e3635b1ede1f2ef02f", "subject": "172.16.1.106" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "657d57bf2357d8e3635b1ede1f2ef02f" }, { "origin": [{ "component": 4, "knowledge": "8a4f13aa93d09795314878c94d4bd8a5" }], "count": 0, "showinfo": "port:9900", "knowledge": { "port": "9900", "id": "819a71049ba8212b4bd5072c1e9e46c0", "service": "http", "subject": "172.16.1.58" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "819a71049ba8212b4bd5072c1e9e46c0" }, { "origin": [{ "component": 4, "knowledge": "22bafeb8cbdbe249c016f277d2b35104" }], "count": 0, "showinfo": "port:6379", "knowledge": { "port": "6379", "id": "e7196874de5bf7ffbcda393fe181a4a3", "service": "redis", "subject": "172.16.1.77" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "e7196874de5bf7ffbcda393fe181a4a3" }, { "origin": [{ "component": 4, "knowledge": "9558ab734cce7c889b59012df7b46052" }], "count": 0, "showinfo": "port:9000", "knowledge": { "port": "9000", "id": "014156041a829490b47a4157b2ee40d3", "service": "http", "subject": "172.16.1.124" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "014156041a829490b47a4157b2ee40d3" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.3.42", "knowledge": { "ip": "172.16.3.42", "id": "a2288ee6d59e3c0932a64a44aff5e0cd", "subject": "172.16.3.42" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "a2288ee6d59e3c0932a64a44aff5e0cd" }, { "origin": [{ "component": 4, "knowledge": "c98827240c92a4715b629a10d7b5133c" }], "count": 0, "showinfo": "port:1521", "knowledge": { "port": "1521", "id": "f63adafa5d3927e2b8345277fe67a65a", "service": "ORACLE", "subject": "172.16.1.221" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "f63adafa5d3927e2b8345277fe67a65a" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.77", "knowledge": { "ip": "172.16.1.77", "id": "22bafeb8cbdbe249c016f277d2b35104", "subject": "172.16.1.77" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "22bafeb8cbdbe249c016f277d2b35104" }, { "origin": [{ "component": 14, "knowledge": "" }], "count": 0, "showinfo": "IP:172.16.1.40", "knowledge": { "ip": "172.16.1.40", "id": "e9948b4ad2c3379207b27b25540fb9f5", "subject": "172.16.1.40" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "e9948b4ad2c3379207b27b25540fb9f5" }, { "origin": [{ "component": 900008, "knowledge": "54d7184e01b61a24e77faad83c9a3f42" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.19,\u5b58\u5728ms17-010", "knowledge": { "product": "smb", "description": "\u76ee\u6807172.16.1.19,\u5b58\u5728ms17-010", "id": "b805c8a727da5b6295c6a0f87bdc3db9", "subject": "172.16.1.19" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "b805c8a727da5b6295c6a0f87bdc3db9", "exploit_file": "b805c8a727da5b6295c6a0f87bdc3db9" }, { "origin": [{ "component": 4, "knowledge": "2096079921f5fa4ec78f9f5510e63cef" }], "count": 0, "showinfo": "port:9000", "knowledge": { "port": "9000", "id": "924a4fc054630bf5e8fe2673baf19aec", "service": "svn", "subject": "172.16.1.138" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "924a4fc054630bf5e8fe2673baf19aec" }, { "origin": [{ "component": 4, "knowledge": "a44f8d87ee47a8d35e0fdedc394c6530" }], "count": 0, "showinfo": "port:21", "knowledge": { "port": "21", "id": "52d96a6636a5edf8c11e20868ac5f39b", "service": "ftp", "subject": "172.16.1.125" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "52d96a6636a5edf8c11e20868ac5f39b" }, { "origin": [{ "component": 4, "knowledge": "aa8f5c25a2a18c35c9b0bdf18c0ccea8" }], "count": 0, "showinfo": "port:3306", "knowledge": { "port": "3306", "id": "f7c494df06ee8f2b4e20772443b588a3", "service": "mysql", "subject": "172.16.1.33" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "f7c494df06ee8f2b4e20772443b588a3" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.58", "knowledge": { "ip": "172.16.1.58", "id": "8a4f13aa93d09795314878c94d4bd8a5", "subject": "172.16.1.58" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "8a4f13aa93d09795314878c94d4bd8a5" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.138", "knowledge": { "ip": "172.16.1.138", "id": "2096079921f5fa4ec78f9f5510e63cef", "subject": "172.16.1.138" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "2096079921f5fa4ec78f9f5510e63cef" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.68", "knowledge": { "ip": "172.16.1.68", "id": "72fbf21e90c303c94f733e24e77574d5", "subject": "172.16.1.68" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "72fbf21e90c303c94f733e24e77574d5" }, { "origin": [{ "component": 900008, "knowledge": "f7c494df06ee8f2b4e20772443b588a3" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.33,mysql\u53e3\u4ee4\u7206\u7834\u6210\u529f", "knowledge": { "product": "mysql", "description": "\u76ee\u6807172.16.1.33,mysql\u53e3\u4ee4\u7206\u7834\u6210\u529f", "id": "0dfc8ef7613d76d2782d463e3839a085", "subject": "172.16.1.33" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "0dfc8ef7613d76d2782d463e3839a085", "exploit_file": "0dfc8ef7613d76d2782d463e3839a085" }, { "origin": [{ "component": 900008, "knowledge": "924a4fc054630bf5e8fe2673baf19aec" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.138,\u5b58\u5728svn\u6cc4\u9732", "knowledge": { "product": "http", "description": "\u76ee\u6807172.16.1.138,\u5b58\u5728svn\u6cc4\u9732", "id": "f47ddb077782f3b404abac3bf30ab3bd", "subject": "172.16.1.138/9000/svn/" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "f47ddb077782f3b404abac3bf30ab3bd", "exploit_file": "f47ddb077782f3b404abac3bf30ab3bd" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.42", "knowledge": { "ip": "172.16.1.42", "id": "8e71053085e36bcfca870456f302fec0", "subject": "172.16.1.42" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "8e71053085e36bcfca870456f302fec0" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.19", "knowledge": { "ip": "172.16.1.19", "id": "3bb093510387a069f559bbfe2fb31fff", "subject": "172.16.1.19" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "3bb093510387a069f559bbfe2fb31fff" }, { "origin": [{ "component": 900008, "knowledge": "014156041a829490b47a4157b2ee40d3" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.124,\u5b58\u5728\u76ee\u5f55\u904d\u5386", "knowledge": { "product": "http", "description": "\u76ee\u6807172.16.1.124,\u5b58\u5728\u76ee\u5f55\u904d\u5386", "id": "097df14926bb65533209f88829a4dc9d", "subject": "172.16.1.124:9000" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "097df14926bb65533209f88829a4dc9d", "exploit_file": "097df14926bb65533209f88829a4dc9d" }, { "origin": [{ "component": 900001, "knowledge": "06ece27e3790fce734452a112f832639" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.42,tomcat\u53e3\u4ee4\u7206\u7834\u6210\u529f\u5e76\u83b7\u53d6\u670d\u52a1\u5668\u6743\u9650", "knowledge": { "product": "tomcat", "description": "\u76ee\u6807172.16.1.42,tomcat\u53e3\u4ee4\u7206\u7834\u6210\u529f\u5e76\u83b7\u53d6\u670d\u52a1\u5668\u6743\u9650", "id": "7564f3ace285d228ec294c63dea789b7", "subject": "172.16.1.42:8090/manager" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "7564f3ace285d228ec294c63dea789b7", "exploit_file": "7564f3ace285d228ec294c63dea789b7" }, { "origin": [{ "component": 900008, "knowledge": "819a71049ba8212b4bd5072c1e9e46c0" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.58,\u5b58\u5728\u654f\u611f\u6570\u636e\u6cc4\u9732", "knowledge": { "product": "http", "description": "\u76ee\u6807172.16.1.58,\u5b58\u5728\u654f\u611f\u6570\u636e\u6cc4\u9732", "id": "65edae10595de527082f21b844788cd7", "subject": "172.16.1.58:9900/main" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "65edae10595de527082f21b844788cd7", "exploit_file": "65edae10595de527082f21b844788cd7" }, { "origin": [{ "component": 4, "knowledge": "a2288ee6d59e3c0932a64a44aff5e0cd" }], "count": 0, "showinfo": "port:8090", "knowledge": { "port": "8090", "id": "06ece27e3790fce734452a112f832639", "service": "tomcat", "subject": "172.16.1.42" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "06ece27e3790fce734452a112f832639" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.64", "knowledge": { "ip": "172.16.1.64", "id": "edbbcbac4a1fead5c6b4811040bd0a83", "subject": "172.16.1.64" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "edbbcbac4a1fead5c6b4811040bd0a83" }, { "origin": [{ "component": 900008, "knowledge": "53ea2f3cc33a221054359457c28ccb70" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.42,\u5b58\u5728Jenkins\u5f31\u53e3\u4ee4", "knowledge": { "product": "Jenkins", "description": "\u76ee\u6807172.16.1.42,\u5b58\u5728Jenkins\u5f31\u53e3\u4ee4", "id": "439d61387eaf96d4e95874e7c8f35ae2", "subject": "172.16.1.42" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "439d61387eaf96d4e95874e7c8f35ae2", "exploit_file": "439d61387eaf96d4e95874e7c8f35ae2" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.125", "knowledge": { "ip": "172.16.1.125", "id": "a44f8d87ee47a8d35e0fdedc394c6530", "subject": "172.16.1.125" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "a44f8d87ee47a8d35e0fdedc394c6530" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.33", "knowledge": { "ip": "172.16.1.33", "id": "aa8f5c25a2a18c35c9b0bdf18c0ccea8", "subject": "172.16.1.33" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "aa8f5c25a2a18c35c9b0bdf18c0ccea8" }, { "origin": [{ "component": 900008, "knowledge": "52d96a6636a5edf8c11e20868ac5f39b" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.125,ftp\u53e3\u4ee4\u7206\u7834\u6210\u529f", "knowledge": { "product": "ftp", "description": "\u76ee\u6807172.16.1.125,ftp\u53e3\u4ee4\u7206\u7834\u6210\u529f", "id": "a610defcf70baa8b97c68f6c7153b7a3", "subject": "172.16.1.125" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "a610defcf70baa8b97c68f6c7153b7a3", "exploit_file": "a610defcf70baa8b97c68f6c7153b7a3" }, { "origin": [{ "component": 4, "knowledge": "3bb093510387a069f559bbfe2fb31fff" }], "count": 0, "showinfo": "port:445", "knowledge": { "port": "445", "id": "54d7184e01b61a24e77faad83c9a3f42", "service": "smb", "subject": "172.16.1.19" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "54d7184e01b61a24e77faad83c9a3f42" }, { "origin": [{ "component": 4, "knowledge": "72fbf21e90c303c94f733e24e77574d5" }], "count": 0, "showinfo": "port:21", "knowledge": { "port": "21", "id": "98e3f1dcb9a064ef8a7fcf66292aa511", "service": "ftp", "subject": "172.16.1.68" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "98e3f1dcb9a064ef8a7fcf66292aa511" }, { "origin": [{ "component": 900008, "knowledge": "f63adafa5d3927e2b8345277fe67a65a" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.221,oracle\u53e3\u4ee4\u7206\u7834\u6210\u529f", "knowledge": { "product": "ORACLE", "description": "\u76ee\u6807172.16.1.221,oracle\u53e3\u4ee4\u7206\u7834\u6210\u529f", "id": "d204b3e98c3702fe6f650df50bc14158", "subject": "172.16.1.221" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "d204b3e98c3702fe6f650df50bc14158", "exploit_file": "d204b3e98c3702fe6f650df50bc14158" }, { "origin": [{ "component": 900008, "knowledge": "5d753a7f6e5147c22393d8e9d98d2db6" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.106,ftp\u53e3\u4ee4\u7206\u7834\u6210\u529f", "knowledge": { "product": "ftp", "description": "\u76ee\u6807172.16.1.106,ftp\u53e3\u4ee4\u7206\u7834\u6210\u529f", "id": "c04a54b09d4a5665507c2f0e9d2b93f8", "subject": "172.16.1.106" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "c04a54b09d4a5665507c2f0e9d2b93f8", "exploit_file": "c04a54b09d4a5665507c2f0e9d2b93f8" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.124", "knowledge": { "ip": "172.16.1.124", "id": "9558ab734cce7c889b59012df7b46052", "subject": "172.16.1.124" }, "datetime": "2017-12-01 11:38:19", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "9558ab734cce7c889b59012df7b46052" }, { "origin": [{ "component": 900008, "knowledge": "818da3f7df90ef35b790d32381aeef9f" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.64,\u5b58\u5728\u76ee\u5f55\u904d\u5386", "knowledge": { "product": "http", "description": "\u76ee\u6807172.16.1.64,\u5b58\u5728\u76ee\u5f55\u904d\u5386", "id": "b9e69eb1b16a0596a05a7d503b141ea3", "subject": "172.16.1.64" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "b9e69eb1b16a0596a05a7d503b141ea3", "exploit_file": "b9e69eb1b16a0596a05a7d503b141ea3" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.164", "knowledge": { "ip": "172.16.1.164", "id": "a87233cabf3c47bf66f64c292c022986", "subject": "172.16.1.164" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "a87233cabf3c47bf66f64c292c022986" }, { "origin": [{ "component": 200006, "knowledge": "e9948b4ad2c3379207b27b25540fb9f5" }], "count": 0, "showinfo": "IP:172.16.1.221", "knowledge": { "ip": "172.16.1.221", "id": "c98827240c92a4715b629a10d7b5133c", "subject": "172.16.1.221" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "ip", "id": "c98827240c92a4715b629a10d7b5133c" }, { "origin": [{ "component": 4, "knowledge": "edbbcbac4a1fead5c6b4811040bd0a83" }], "count": 0, "showinfo": "port:80", "knowledge": { "port": "80", "id": "818da3f7df90ef35b790d32381aeef9f", "service": "http", "subject": "172.16.1.64" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "818da3f7df90ef35b790d32381aeef9f" }, { "origin": [{ "component": 4, "knowledge": "657d57bf2357d8e3635b1ede1f2ef02f" }], "count": 0, "showinfo": "port:9010", "knowledge": { "port": "9010", "id": "5d753a7f6e5147c22393d8e9d98d2db6", "service": "ftp", "subject": "172.16.1.106" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "5d753a7f6e5147c22393d8e9d98d2db6" }, { "origin": [{ "component": 900008, "knowledge": "e7196874de5bf7ffbcda393fe181a4a3" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.77,redis\u53e3\u4ee4\u7206\u7834\u6210\u529f", "knowledge": { "product": "redis", "description": "\u76ee\u6807172.16.1.77,redis\u53e3\u4ee4\u7206\u7834\u6210\u529f", "id": "f960107ce41bab0c6cb852530fe937e3", "subject": "172.16.1.77" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "f960107ce41bab0c6cb852530fe937e3", "exploit_file": "f960107ce41bab0c6cb852530fe937e3" }, { "origin": [{ "component": 900008, "knowledge": "4846f6976b48684b3d493bcf0e7214c0" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.164,Elasticsearch\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c", "knowledge": { "product": "Elasticsearch", "description": "\u76ee\u6807172.16.1.164,Elasticsearch\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c", "id": "8a60787782328486226e1b53d760a553", "subject": "172.16.1.164:9200/_plugin/head/" }, "datetime": "2017-12-01 11:38:20", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "8a60787782328486226e1b53d760a553", "exploit_file": "8a60787782328486226e1b53d760a553" }, { "origin": [{ "component": 4, "knowledge": "a87233cabf3c47bf66f64c292c022986" }], "count": 0, "showinfo": "port:9200", "knowledge": { "port": "9200", "id": "4846f6976b48684b3d493bcf0e7214c0", "service": "Elasticsearch", "subject": "172.16.1.164" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "4846f6976b48684b3d493bcf0e7214c0" }, { "origin": [{ "component": 900008, "knowledge": "98e3f1dcb9a064ef8a7fcf66292aa511" }], "count": 0, "showinfo": "\u76ee\u6807172.16.1.68,ftp\u53e3\u4ee4\u7206\u7834\u6210\u529f", "knowledge": { "product": "ftp", "description": "\u76ee\u6807172.16.1.68,ftp\u53e3\u4ee4\u7206\u7834\u6210\u529f", "id": "8a0986ef88b80d044d9bd4d9c38c6f85", "subject": "172.16.1.68" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "vulnerability", "id": "8a0986ef88b80d044d9bd4d9c38c6f85", "exploit_file": "8a0986ef88b80d044d9bd4d9c38c6f85" }, { "origin": [{ "component": 4, "knowledge": "8e71053085e36bcfca870456f302fec0" }], "count": 0, "showinfo": "port:8090", "knowledge": { "port": "8090", "id": "53ea2f3cc33a221054359457c28ccb70", "service": "Jenkins", "subject": "172.16.1.42" }, "datetime": "2017-12-01 11:38:21", "status": "new", "entry": ["e9948b4ad2c3379207b27b25540fb9f5"], "type": "port", "id": "53ea2f3cc33a221054359457c28ccb70" }] };
io.on('connection', function(socket) {
    ws = socket;
    socket.on("getNodes", function(data) {
        console.log("get");
        console.log(data);
        socket.emit("nodePush", { data: getInfo(data.data) })
        console.log("to");
    });
    socket.on("getRoot", function(data) {
        socket.emit("nodePush", {
            data: [{
                id: 123654,
                showinfo: 'vackbot',
                is_root: true
            }]
        })
    });
});
function getInfo(pid) {
    let ret = [];
    let count = Math.ceil(Math.random() * 10);
    if (count < 1) {
        count = 1;
    }
    let i = 0;
    for (i; i < count; i++) {
        let id = Math.ceil(Math.random() * 100);

        if (dataStart.knowledge[id]) {
            dataStart.knowledge[id].origin_knowledge = pid;
            ret.push(dataStart.knowledge[id]);
        }
    }

    return ret;
}
app.use(express.static("tree/"));
//server.listen(87);

var myServer = server.listen(86, function() {
    var host = server.address().address;
    var port = server.address().port;

    console.log("应用实例，访问地址为:");
    console.log('ws://10.10.10.162/vackbot');
    console.log('攻击路径：' + 'http://localhost:86/index.html?taskid=cf39c1ba-a027-11e8-b232-000c29fc137b&knowledge_id=undefined');
    console.log('敏感数据：' + 'http://localhost:86/sensitive.html?taskid=6a852a16-9f41-11e8-b918-000c29ac46eb&knowledge_id=60433fb3690a6524350cbd739f5abace');
});